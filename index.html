<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Basic WebXR AR</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <button id="start-ar">Start AR</button>
    <script>
        let xrSession = null;
        let gl = null;
        let xrRefSpace = null;

        document.getElementById('start-ar').addEventListener('click', async () => {
            if (!navigator.xr) {
                alert("WebXR not supported");
                return;
            }

            const isSupported = await navigator.xr.isSessionSupported('immersive-ar');
            if (!isSupported) {
                alert("immersive-ar not supported on this device/browser");
                return;
            }

            try {
                xrSession = await navigator.xr.requestSession('immersive-ar', {
                    requiredFeatures: ['local'],
                    optionalFeatures: ['dom-overlay'],
                    domOverlay: { root: document.body }
                });

                const canvas = document.createElement('canvas');
                document.body.appendChild(canvas);
                gl = canvas.getContext('webgl', { xrCompatible: true });

                await gl.makeXRCompatible();

                const xrLayer = new XRWebGLLayer(xrSession, gl);
                xrSession.updateRenderState({ baseLayer: xrLayer });

                xrRefSpace = await xrSession.requestReferenceSpace('local');

                xrSession.requestAnimationFrame(onXRFrame);

            } catch (err) {
                console.error(err);
                alert("Failed to start AR session");
            }
        });

        function onXRFrame(time, frame) {
            let session = frame.session;
            session.requestAnimationFrame(onXRFrame);

            const pose = frame.getViewerPose(xrRefSpace);
            if (!pose) return;

            const glLayer = session.renderState.baseLayer;
            gl.bindFramebuffer(gl.FRAMEBUFFER, glLayer.framebuffer);

            gl.clearColor(0, 0, 0, 0);
            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

            // You can render WebGL content here
        }
    </script>
</body>

</html>